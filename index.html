<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, maximum-scale=1, initial-scale=1.0">
    <title>거기어디?</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/style.css" />


</head>

<body>
    <script src="https://code.jquery.com/jquery-3.5.1.js"
        integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>

    <script type="text/javascript"
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=4f87397342a5a6257622aad28f62bca9"></script>

    <header>

        <div class="mx-auto mt-1 input-group mb-3">
            <input id="keywordName" type="text" class="form-control" placeholder="찾고 싶은 곳.."
                aria-label="Recipient's username" aria-describedby="button-addon2">
            <button class="btn btn-outline-secondary" type="button" id="button-addon2">검색</button>
    </header>




    <div class="flexbox-wrapper">
        <div id="map" class="sticky">

        </div>

        <div class="regular">
            <div id="result" class="result_style">
            </div>

        </div>

        <script>
            // Geolocation API에 액세스할 수 있는지를 확인
            if (navigator.geolocation) {
                //위치 정보를 얻기
                navigator.geolocation.getCurrentPosition(function (pos) {
                    x = pos.coords.latitude;
                    y = pos.coords.longitude;


                    var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
                        mapOption = {
                            center: new kakao.maps.LatLng(x, y), // 지도의 중심좌표
                            level: 4 // 지도의 확대 레벨
                        };

                    var map = new kakao.maps.Map(mapContainer, mapOption);

                    // 마커가 표시될 위치입니다 
                    var markerPosition = new kakao.maps.LatLng(x, y);

                    // 마커를 생성합니다
                    var marker = new kakao.maps.Marker({
                        position: markerPosition
                    });

                    // 마커가 지도 위에 표시되도록 설정합니다
                    marker.setMap(map);

                });
            } else {
                alert("이 브라우저에서는 Geolocation이 지원되지 않습니다.")
            }


            $(document).ready(function () {
                $("#button-addon2").click(function () {
                    $("#result").empty();
                    $("#map").empty();
                    $.ajax({
                        method: "GET",
                        url: "https://dapi.kakao.com/v2/local/search/keyword.json?y=" + x + "&x=" + y,
                        data: { query: $("#keywordName").val() },
                        headers: { Authorization: "KakaoAK eaba352137de06ddce13c272d9ce9756" }
                    })


                        .done(function (msg) {

                            console.log(msg);
                            

                            var imageSrc = new Array();
                            imageSrc[0] = "http://maps.google.com/mapfiles/markerA.png";
                            imageSrc[1] = "http://maps.google.com/mapfiles/markerB.png";
                            imageSrc[2] = "http://maps.google.com/mapfiles/markerC.png";
                            imageSrc[3] = "http://maps.google.com/mapfiles/markerD.png";
                            imageSrc[4] = "http://maps.google.com/mapfiles/markerE.png";


                            for (i = 0; i < 15; i++) {
                                $("#result").append("<img src='"+imageSrc[i]+"'>&nbsp;" + msg.documents[i].place_name + "<br>");


                                if (msg.documents[i].road_address_name) {
                                    $("#result").append("주소 : " + msg.documents[i].road_address_name + "<br>");
                                } else {
                                    $("#result").append("주소 : " + msg.documents[i].address_name + "<br>");
                                }
                                if (msg.documents[i].phone) {
                                    $("#result").append("전화 : <a href='tel:" + msg.documents[i].phone + "'>" + msg.documents[i].phone + "</a><br>");
                                }

                                $("#result").append("지도 : <a href='" + msg.documents[i].place_url + "' target='_blank'>" + msg.documents[i].place_url + "</a><br>");
                                $("#result").append("거리 : " + msg.documents[i].distance + "&nbsp;m<br><br>");

                            }

                            var keyword_x = msg.documents[0].y;
                            var keyword_y = msg.documents[0].x;

                            var mapContainer = document.getElementById('map'), // 지도를 표시할 div  


                            mapOption = {
                                center: new kakao.maps.LatLng(keyword_x, keyword_y), // 지도의 중심좌표
                                level: 5 // 지도의 확대 레벨
                            };

                            var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

                            // 마커를 표시할 위치와 title 객체 배열입니다 
                            var positions = [
                                {
                                    title: msg.documents[0].place_name,
                                    latlng: new kakao.maps.LatLng(msg.documents[0].y, msg.documents[0].x)
                                },
                                {
                                    title: msg.documents[1].place_name,
                                    latlng: new kakao.maps.LatLng(msg.documents[1].y, msg.documents[1].x)
                                },
                                {
                                    title: msg.documents[2].place_name,
                                    latlng: new kakao.maps.LatLng(msg.documents[2].y, msg.documents[2].x)
                                },
                                {
                                    title: msg.documents[3].place_name,
                                    latlng: new kakao.maps.LatLng(msg.documents[3].y, msg.documents[3].x)
                                }
                            ];

                            // 마커 이미지의 이미지 주소입니다
                           

                            for (var i = 0; i < positions.length; i++) {

                                // 마커 이미지의 이미지 크기 입니다
                                var imageSize = new kakao.maps.Size(24, 35);

                                // 마커 이미지를 생성합니다    
                                var markerImage = new kakao.maps.MarkerImage(imageSrc[i], imageSize);

                                // 마커를 생성합니다
                                var marker = new kakao.maps.Marker({
                                    map: map, // 마커를 표시할 지도
                                    position: positions[i].latlng, // 마커를 표시할 위치
                                    title: positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
                                    image: markerImage // 마커 이미지 
                                });
                            }
                        });
                });
                $('#keywordName').keypress(function (event) {
                    if (event.which == 13) {
                        $('#button-addon2').click();
                        return false; // 검색창에서 엔터 쳤을 때
                    }
                });


            });
        </script>

</body>

</html>